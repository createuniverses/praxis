print2(getFunction(update))
function update()
  WidgetLib.callAll("update")

  for i=1,#skythings,1 do
    local thing = skythings[i]
    local planepos = vec3d(transform.getTranslation(airplane.lspace))
    local tween = thing.p - planepos
    local dist = Vector3D.magnitude(tween)
    tween = Vector3D.normalize(tween)
    if dist < (30 + thing.r) then
      thing.p = planepos + (tween * (30+thing.r))
    end
  end

  local r,g,b = getClearColor()
  r = clamp(r-20,0,255)
  g = clamp(g-20,0,255)
  b = clamp(b-20,0,255)
  setClearColor(r,g,b)
end


function newupdate(update, name)
  local w = WidgetLib2.newSimple(name)
  w.update = update
  Widgets[name] = w
end

do
 newupdate(
  function (o)
    local x,y,z = getCamPos()
    y = y + 2
    if y > 60 then y = 60 end
    setCamPos(x,y,z)
  end,
  "cameradown") 
end




do
  closeBuffer()
  switchToBuffer("textshader.lua")
end
